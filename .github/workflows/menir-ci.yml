name: Menir CI Setup

on:
  workflow_dispatch:
  push:
    branches: [ "main" ]

jobs:
  setup:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Install cypher-shell
        run: |
          curl -L https://dist.neo4j.org/cypher-shell/cypher-shell-5.latest.zip -o cs.zip
          unzip -p cs.zip cypher-shell-5.*/*/bin/cypher-shell > /usr/local/bin/cypher-shell
          chmod +x /usr/local/bin/cypher-shell

      - name: Apply schema + import
        env:
          NEO4J_URI: ${{ secrets.NEO4J_URI }}
          NEO4J_USER: ${{ secrets.NEO4J_USER }}
          NEO4J_PASSWORD: ${{ secrets.NEO4J_PASSWORD }}
        run: |
          cypher-shell -a "$NEO4J_URI" -u "$NEO4J_USER" -p "$NEO4J_PASSWORD" -f setup.cypher
